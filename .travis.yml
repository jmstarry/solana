branches:
  only:
    - master
    - /^v\d+\.\d+/

os: linux
dist: bionic
language: minimal

jobs:
  include:
    # explorer pull request
    - name: "explorer"
      if: type = pull_request AND branch = master

      language: node_js
      node_js:
        - "node"

      cache:
        directories:
          - ~/.npm

      before_install:
        - .travis/affects.sh explorer/ .travis || travis_terminate 0
        - cd explorer

      script:
        - npm run build
        - npm run format

    # web3.js pull request
    - name: "web3.js"
      if: type = pull_request AND branch = master

      language: node_js
      node_js:
        - "lts/*"

      services:
        - docker

      cache:
        directories:
          - ~/.npm

      before_install:
        - .travis/affects.sh web3.js/ .travis || travis_terminate 0
        - cd web3.js/
        - source .travis/before_install.sh

      script:
        - ../.travis/commitlint.sh
        - source .travis/script.sh

    # docs pull request
    - name: "docs"
      if: type IN (push, pull_request) OR tag IS present
      language: node_js
      node_js:
        - "node"

      services:
        - docker

      cache:
        directories:
          - ~/.npm

      before_install:
        - source ci/env.sh
        - .travis/channel_restriction.sh edge beta || travis_terminate 0
        - .travis/affects.sh docs/ .travis || travis_terminate 0
        - cd docs/
        - source .travis/before_install.sh

      script:
        - source .travis/script.sh
